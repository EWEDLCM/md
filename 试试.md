
# （萌新折腾笔记）影视天地系列——Nastools部署（一）

## 目录
[toc]
## 前言
本文系列文章面向初学者，可能包含较多图片和代码。内容基于个人经验编写，会力求详细易懂，但不一定是最优解。有基础的读者可以自行跳过，萌新请务必一步一步进行。

## 注意事项
无论使用何种容器，都建议使用 Docker Compose 进行部署。Compose 便于调整配置、管理和迁移容器。飞牛 NAS 系统已提供图形界面，只需将代码填入并进行相应设置即可。从本文起仅会提供Compose代码，不再详讲，如有兴趣可查看：[（萌新折腾笔记）简单讲解系列—认识Docker Compose](https://club.fnnas.com/forum.php?mod=viewthread&tid=2717)

## 什么是Nastools？
NASTools 是一套用于管理和自动化 NAS 系统的工具，也可以算是 MoviePilot 的前身（对 MP 感兴趣可以跳转 @Mickeyilmaz 的文章：[MoviePilot新手喂饭教程之部署篇](https://club.fnnas.com/forum.php?mod=viewthread&tid=1568&extra=page%3D1)）。Nastools 主要功能包括自动下载管理（RSS 订阅、BT 搜索下载）、媒体管理（如文件重命名、元数据更新、媒体库同步）和自动化任务（如定时清理、备份、通知）等。它还提供友好的 Web 界面和 API 支持，方便用户管理和扩展功能。

由于资源较为敏感，本文不提供任何仓库地址，仅表述部署配置方法。

## 开始部署
本系列所有 Docker 容器都在 `/docker` 下，大多数情况下使用 Compose 进行部署不需要手动创建文件夹，只读挂载等特殊情况除外。前期强烈建议自行创建好目录，这将有助于对目录结构的了解，既方便后续维护，也避免了输入错误的尴尬。

### 步骤一：创建目录
在我们准备好的 Docker 文件夹下逐级创建 `nastools/config`，用来映射 Nastools 的配置文件。在用户文件管理器根目录下创建媒体文件夹，用于存放媒体文件，本处使用 `media` 做示范。因为我需要把资源上传到 115 网盘，因此此处我会在 115 内也创建一个 `media` 的文件夹，方便确认位置。

此时，我需要准备的三个路径如下（右键详细信息-位置可查看）：
- Nastools 配置目录： `/vol1/1000/docker/nastools/config`
- qbittorrent 配置目录：`/vol1/1000/docker/qbittorrent/config`
- Jackett 配置目录：  `/vol1/1000/docker/jackett/config`
- Jackett 种子下载目录：`/vol1/1000/docker/jackett/downloads`
- 本地媒体文件存放目录：`/vol1/1000/media`（`media` 内新建电影、动漫、电视剧、整理四个文件夹）
- 本地媒体整理文件目录：`/vol1/1000/media/整理`（整理内再次新建电影、动漫、电视剧三个文件夹）
- 115（网盘）媒体文件存放目录：`/vol02/1000-1-19……qq.com/115/media`（`media` 内新建电影、动漫、电视剧三个文件夹）

**注意**：115 下的 `media` 等同于上面本地媒体整理文件目录（/vol1/1000/media/整理），只是他放在云端，如果实在无法理解，就把115路径改成：/vol02/1000-1-19……qq.com/115/media/整理

### 步骤二：使用 Compose 构建项目
此处本次我们需要部署 Nastools 、jackett 和 qbittorrent 三个项目
- Nastools Compose 读写链接：[Nastools Compose](https://netcut.cn/Nastools配置部署)
- Nastools Compose 只读链接：[Nastools Compose](https://netcut.cn/p/fcead02e81d74c62)
- Qbittorrent Compose 读写链接：[Qbittorrent Compose](https://netcut.cn/qbittorrent配置部署)
- Qbittorrent Compose 只读链接：[Qbittorrent Compose](https://netcut.cn/p/3a762fce9f5b6e6c)
- Jackett Compose 读写链接：[Jackett Compose](https://netcut.cn/jackett配置部署)
- Jackett Compose 只读链接：[Jackett Compose](https://netcut.cn/p/1bb254fe5099a2e6)
- 当然你也可以使用懒人专属三合一Compose-host只读链接：[三合一Compose](https://netcut.cn/p/e2e97a697e1a1212)
- 当然你也可以使用懒人专属三合一Compose-host读写链接：[三合一Compose](https://netcut.cn/三合一Compose)
- 当然你也可以使用懒人专属三合一Compose-bridge只读链接：[三合一Compose](https://netcut.cn/p/e2e97a697e1a1212)
- 当然你也可以使用懒人专属三合一Compose-bridge读写链接：[三合一Compose](https://netcut.cn/三合一Compose)
### 步骤三：Nastools 基本配置

#### 1. 修改 WebUI 账户密码
使用 IP+端口号 3000 进入 Nastools 目录，默认账户 admin 密码 password。进入后会提示失败，不用紧张，来到基础设置界面，修改 Web 管理用户和密码，然后点击这一方框中的保存，刷新界面重新登录即可。（必须先做这一步，否则后续修改不生效）


#### 2. 设置媒体库
来到媒体库界面，分别点击加号设置媒体库路径，本处一律填写整理后目录。

#### 3. 设置同步目录
来到目录同步界面，点击加号为上面设置的三个媒体库设置目录同步，此处，源目录指向管理前，目标目录指向管理后，本地使用硬链接模式，上传网盘使用复制模式（上传完成后你可以随时对源目录内容进行删除）。

#### 4. 添加下载器
添加下载器前，我们需要先对 qbittorrent 进行简单设置。我们先回到飞牛 NAS 界面，点击 Docker-容器-qbittorrent，点击右边的日志图标，在日志内可以找到我们的用户名和临时密码。接着回到浏览器地址栏输入 IP:8080 即可进入 qbittorrent 界面，使用刚刚得到的用户名密码进行登录。
进入到 qb 后，点击上面的设置图标，在 Behavior 界面找到 language 设置，点击 English 后下拉找到并选择简体中文，点 Save 即可完成语言修改；
再次进入设置，来到连接界面，将监听端口处的随机点击一次，来到 WebUI 界面，设置用户名密码，拉到最下面点保存。
至此，我们完成了 qb 上的所有设置。
回到 Nastools-下载器界面，点击新增下载器，按要求进行填写。
还记得我们 qbittorrent 的目录映射吗？我们把整个 `/vol1/1000/` 映射到了 `/downloads` 文件夹，也就是说这两个路径下面的内容是相同的，所以我们在 Nastools 的 qb 下载器目录设置中，只需要把所有的 `/vol1/1000/` 替换成 `/downloads` 就可以了。可以参考我的设置。完成后点上 qb 下载器图标右上角的小星星。
至此，我们完成了下载器的设置。
#### 5. 填写 TMDB 的 API
在浏览器打开 [The Movie Database (TMDb)](https://www.themoviedb.org/) 进行注册，和常规的注册一样，完成后网站会发送一封邮件到你的邮箱，在邮箱验证后即可回到原页面进行登录，此处不做过多赘述。
登录之后点击右上角用户头像，依次选择账户设置-API-clickhere，会跳出用户须知页面，拉到最底部点接受开始进行 API 创建；
跳转到页面后选择 “developer” 以个人名义创建，信息内容随意填写，网站不做验证，内容尽量写长一些即可成功。
信息填写提交后，自动跳转到 API 一开始的 API 界面，我们就已经可以看到这串 API 了，复制短 API 填写进 Nastools 中，修改内容如图所示，然后点击保存即可。这样我们应该就可以在探索看到 TMDb 的预览图和信息了。
#### 6. 设置索引器
在浏览器地址栏输入 IP:9117（端口）进入 Jackett UI 界面。点击 add indexer，会弹出界面列出所有的索引器站点，我们需要在 type 处，把 show all 改为 Public（免费），接下来就是枯燥无味的勾选阶段，我个人的做法是把全部免费都勾上，然后点击最下面的 Add Selected 进行添加。一些大佬可能有自己比较信赖的站点，但我不是大佬，所以只能老老实实全部添加，这里会花不少时间，如果你没有代理环境，还需要在添加后点击 test 进行测试，删除不可用的索引器站点。
最后，我们复制首页左上角的 API，回到 Nastools-索引器界面，点击 Jackett，输入地址（也就是 IP：端口号）和刚刚复制的 key，左下角测试成功即可点击完成。
至此，我们已经可以在 Nastools 界面搜索影片并进行订阅、下载。

<!--stackedit_data:
eyJoaXN0b3J5IjpbMTU0ODgzMjcyMywxNjMwOTI0NTMxXX0=
-->